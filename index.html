<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>ğŸ‘¶ å©´å„¿æŠ¤ç†æ•°æ®çœ‹æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 15px;
            min-height: 100vh
        }

        .container {
            max-width: 600px;
            margin: 0 auto
        }

        h1 {
            color: #fff;
            text-align: center;
            margin-bottom: 20px;
            font-size: 24px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, .2)
        }

        .file-input-container {
            background: rgba(255, 255, 255, .95);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, .1)
        }

        .file-input-container input {
            display: none
        }

        .file-label {
            display: inline-block;
            padding: 12px 24px;
            background: #667eea;
            color: #fff;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all .3s
        }

        .file-label:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, .2)
        }

        .status {
            margin-top: 10px;
            font-size: 13px;
            color: #666;
            font-weight: 500
        }

        .chart-lib-notice {
            background: rgba(255, 235, 59, .2);
            border-left: 4px solid #ffc107;
            padding: 12px;
            margin-top: 10px;
            border-radius: 4px;
            font-size: 12px;
            color: #333
        }

        .chart-lib-buttons {
            display: flex;
            gap: 10px;
            margin-top: 10px;
            justify-content: center;
            flex-wrap: wrap
        }

        .lib-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
            transition: all .3s;
            font-weight: 600
        }

        .lib-btn.primary {
            background: #667eea;
            color: #fff
        }

        .lib-btn.primary:hover {
            background: #5568d3
        }

        .lib-btn.secondary {
            background: #e0e0e0;
            color: #333
        }

        .lib-btn.secondary:hover {
            background: #d0d0d0
        }

        .lib-status {
            margin-top: 8px;
            font-size: 12px;
            color: #666;
            text-align: center
        }

        .today-summary {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a6f 100%);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, .2);
            color: #fff
        }

        .today-summary h2 {
            font-size: 18px;
            margin-bottom: 12px;
            text-align: center;
            font-weight: 700
        }

        .today-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px
        }

        .today-card {
            background: rgba(255, 255, 255, .15);
            padding: 10px;
            border-radius: 8px;
            backdrop-filter: blur(10px)
        }

        .today-card h3 {
            font-size: 13px;
            margin-bottom: 6px;
            font-weight: 700
        }

        .today-card .detail {
            font-size: 12px;
            margin: 4px 0;
            display: flex;
            justify-content: space-between
        }

        .today-card .num {
            font-size: 16px;
            font-weight: 700
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 15px
        }

        .stat-card {
            background: rgba(255, 255, 255, .95);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, .1)
        }

        .stat-card h3 {
            font-size: 13px;
            color: #666;
            margin-bottom: 8px
        }

        .stat-card .value {
            font-size: 24px;
            font-weight: 700;
            color: #667eea
        }

        .stat-card .unit {
            font-size: 12px;
            color: #999
        }

        .chart-container {
            background: rgba(255, 255, 255, .95);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, .1)
        }

        .chart-title {
            font-size: 16px;
            font-weight: 700;
            color: #333;
            margin-bottom: 15px;
            text-align: center
        }

        canvas {
            max-height: 250px;
            touch-action: pan-y
        }

        .legend {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            font-size: 12px
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px
        }

        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 2px
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>ğŸ‘¶ å©´å„¿æŠ¤ç†æ•°æ®çœ‹æ¿</h1>
        <div class="file-input-container"><label for="csvFile" class="file-label">ğŸ“ é€‰æ‹©CSVæ–‡ä»¶</label><input type="file"
                id="csvFile" accept=".csv">
            <div class="status" id="status">ç­‰å¾…é€‰æ‹©æ–‡ä»¶...</div>
            <div id="chartLibNotice" class="chart-lib-notice" style="display:none">âš ï¸ Chart.js æœªåŠ è½½ï¼šè¯·å…ˆç‚¹å‡»ä¸‹æ–¹æŒ‰é’®åŠ è½½å›¾è¡¨åº“ï¼ˆé¦–æ¬¡ç¦»çº¿ä½¿ç”¨ï¼‰
                <div class="chart-lib-buttons"><button class="lib-btn primary" id="loadChartBtn">ğŸ“¦
                        é€‰æ‹©Chart.jsï¼ˆé¦–æ¬¡ç¦»çº¿ä½¿ç”¨ï¼‰</button><button class="lib-btn secondary" id="loadOnlineBtn">ğŸŒ
                        ä»CDNåŠ è½½ï¼ˆéœ€è”ç½‘ï¼‰</button></div>
                <div class="lib-status" id="libStatus">Chart.js æœªå°±ç»ªï¼ˆä»…éœ€é€‰æ‹©ä¸€æ¬¡ï¼Œéšåç¦»çº¿å¯ç”¨ï¼‰</div><input type="file"
                    id="chartjsFile" accept=".js" style="display:none">
            </div>
        </div>
        <div id="dataContainer" style="display:none">
            <div class="today-summary">
                <h2>ğŸ“‹ ä»Šæ—¥æ±‡æ€» <span id="todayDate"></span></h2>
                <div class="today-grid">
                    <div class="today-card">
                        <h3>ğŸ¼ å–‚å¥¶æƒ…å†µ</h3>
                        <div class="detail"><span>æ€»æ¬¡æ•°</span><span class="num" id="todayFeedingCount">-</span><span>
                                æ¬¡</span></div>
                        <div class="detail"><span>å¥¶ç²‰</span><span class="num" id="todayFormula">-</span><span> ml</span>
                        </div>
                        <div class="detail"><span>æ¯ä¹³</span><span class="num" id="todayBreast">-</span><span> åˆ†é’Ÿ</span>
                        </div>
                    </div>
                    <div class="today-card">
                        <h3>ğŸ˜´ ç¡çœ æƒ…å†µ</h3>
                        <div class="detail"><span>æ¬¡æ•°</span><span class="num" id="todaySleepCount">-</span><span>
                                æ¬¡</span></div>
                        <div class="detail"><span>æ€»æ—¶é•¿</span><span class="num" id="todaySleepTotal">-</span><span>
                                å°æ—¶</span></div>
                        <div class="detail"><span>æœ€é•¿</span><span class="num" id="todaySleepMax">-</span><span> å°æ—¶</span>
                        </div>
                    </div>
                </div>
                <div class="today-grid">
                    <div class="today-card">
                        <h3>ğŸŒ ç™½å¤© (6-20ç‚¹)</h3>
                        <div class="detail"><span>å–‚å¥¶</span><span class="num" id="todayDayFeeding">-</span><span>
                                æ¬¡</span></div>
                        <div class="detail"><span>ç¡çœ </span><span class="num" id="todayDaySleep">-</span><span> å°æ—¶</span>
                        </div>
                    </div>
                    <div class="today-card">
                        <h3>ğŸŒ™ å¤œé—´ (20-6ç‚¹)</h3>
                        <div class="detail"><span>å–‚å¥¶</span><span class="num" id="todayNightFeeding">-</span><span>
                                æ¬¡</span></div>
                        <div class="detail"><span>ç¡çœ </span><span class="num" id="todayNightSleep">-</span><span>
                                å°æ—¶</span></div>
                    </div>
                </div>
                <div id="todayOther" style="display:none" class="today-grid">
                    <div class="today-card" id="todayWeightCard" style="display:none">
                        <h3>âš–ï¸ ä½“é‡</h3>
                        <div class="num" id="todayWeight" style="text-align:center">-kg</div>
                    </div>
                    <div class="today-card" id="todayFoodCard" style="display:none">
                        <h3>ğŸ¥„ è¾…é£Ÿ</h3>
                        <div class="num" id="todayFood" style="text-align:center">-æ¬¡</div>
                    </div>
                    <div class="today-card" id="todayPoopCard" style="display:none">
                        <h3>ğŸ’© å¤§ä¾¿</h3>
                        <div class="num" id="todayPoop" style="text-align:center">-æ¬¡</div>
                    </div>
                </div>
            </div>
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>æ—¥å‡å¥¶ç²‰</h3>
                    <div class="value" id="avgFormula">-</div>
                    <div class="unit">ml</div>
                </div>
                <div class="stat-card">
                    <h3>æ—¥å‡æ¯ä¹³</h3>
                    <div class="value" id="avgBreast">-</div>
                    <div class="unit">åˆ†é’Ÿ</div>
                </div>
                <div class="stat-card">
                    <h3>æ—¥å‡ç¡çœ </h3>
                    <div class="value" id="avgDailySleep">-</div>
                    <div class="unit">å°æ—¶</div>
                </div>
                <div class="stat-card">
                    <h3>å½“å‰ä½“é‡</h3>
                    <div class="value" id="currentWeight">-</div>
                    <div class="unit">kg</div>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-title">ğŸ“Š æ¯æ—¥å–‚å¥¶ç»Ÿè®¡</div><canvas id="feedingChart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">ğŸ“ˆ å¥¶ç²‰ç”¨é‡è¶‹åŠ¿</div><canvas id="formulaChart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">ğŸ¼ æ¯ä¹³æ—¶é•¿è¶‹åŠ¿</div><canvas id="breastChart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">âš–ï¸ ä½“é‡å˜åŒ–è¶‹åŠ¿</div><canvas id="weightChart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">ğŸ’© å¤§ä¾¿æ¬¡æ•°è®°å½•</div><canvas id="poopChart"></canvas>
            </div>
            <div class="chart-container">
                <div class="chart-title">ğŸ˜´ ç¡çœ æ—¶é•¿ (ç™½å¤© vs å¤œé—´)</div><canvas id="sleepChart"></canvas>
                <div class="legend">
                    <div class="legend-item">
                        <div class="legend-color" style="background:rgba(255,206,86,0.8)"></div><span>ç™½å¤©</span>
                    </div>
                    <div class="legend-item">
                        <div class="legend-color" style="background:rgba(153,102,255,0.8)"></div><span>å¤œé—´</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>let charts = {}; let chartData = null; let hasChartJS = false; function checkChartJS() { if (typeof Chart !== 'undefined') { hasChartJS = true; document.getElementById('chartLibNotice').style.display = 'none'; document.getElementById('libStatus').textContent = 'âœ… Chart.js å·²åŠ è½½'; return true } return false } function tryLoadChartJS() { const savedChart = localStorage.getItem('chartjs_lib'); if (savedChart) { try { eval(savedChart); if (checkChartJS()) { console.log('ä»ç¼“å­˜åŠ è½½Chart.jsæˆåŠŸ'); return true } } catch (e) { console.error('ç¼“å­˜çš„Chart.jsåŠ è½½å¤±è´¥', e); localStorage.removeItem('chartjs_lib') } } const script = document.createElement('script'); script.src = 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js'; script.onload = function () { checkChartJS(); if (chartData) { renderCharts(chartData) } }; script.onerror = function () { console.log('CDNåŠ è½½å¤±è´¥'); document.getElementById('chartLibNotice').style.display = 'block' }; document.head.appendChild(script) } tryLoadChartJS(); document.getElementById('loadOnlineBtn').addEventListener('click', function () { document.getElementById('libStatus').textContent = 'â³ æ­£åœ¨ä»CDNåŠ è½½...'; const script = document.createElement('script'); script.src = 'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js'; script.onload = function () { if (checkChartJS()) { fetch('https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js').then(r => r.text()).then(code => { localStorage.setItem('chartjs_lib', code); document.getElementById('libStatus').textContent = 'âœ… Chart.js å·²åŠ è½½å¹¶ç¼“å­˜ï¼ˆç°åœ¨å¯ç¦»çº¿ä½¿ç”¨ï¼‰'; if (chartData) renderCharts(chartData) }).catch(e => { document.getElementById('libStatus').textContent = 'âœ… Chart.js å·²åŠ è½½ï¼ˆç¼“å­˜å¤±è´¥ï¼Œä¸‹æ¬¡éœ€è”ç½‘ï¼‰'; if (chartData) renderCharts(chartData) }) } }; script.onerror = function () { document.getElementById('libStatus').textContent = 'âŒ CDNåŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œ' }; document.head.appendChild(script) }); document.getElementById('loadChartBtn').addEventListener('click', function () { document.getElementById('chartjsFile').click() }); document.getElementById('chartjsFile').addEventListener('change', function (e) { const file = e.target.files[0]; if (!file) return; document.getElementById('libStatus').textContent = 'â³ æ­£åœ¨åŠ è½½Chart.js...'; const reader = new FileReader(); reader.onload = function (ev) { try { eval(ev.target.result); if (checkChartJS()) { localStorage.setItem('chartjs_lib', ev.target.result); document.getElementById('libStatus').textContent = 'âœ… Chart.js å·²åŠ è½½å¹¶ç¼“å­˜ï¼ˆç°åœ¨å¯ç¦»çº¿ä½¿ç”¨ï¼‰'; if (chartData) renderCharts(chartData) } else { document.getElementById('libStatus').textContent = 'âŒ æ–‡ä»¶ä¸æ˜¯æœ‰æ•ˆçš„Chart.js' } } catch (err) { document.getElementById('libStatus').textContent = 'âŒ åŠ è½½å¤±è´¥ï¼š' + err.message } }; reader.readAsText(file) }); function parseCSV(text) { const lines = text.trim().split('\n'); if (lines.length < 2) return []; const firstLine = lines[0]; const delimiter = firstLine.includes(',') && !firstLine.includes('\t') ? ',' : '\t'; const headers = firstLine.split(delimiter).map(h => h.trim()); const data = []; for (let i = 1; i < lines.length; i++) { const line = lines[i].trim(); if (!line) continue; const cols = line.split(delimiter); const row = {}; let hasData = false; headers.forEach((header, idx) => { row[header] = (cols[idx] || '').trim(); if (row[header] && header === 'timestamp') hasData = true }); if (hasData) data.push(row) } return data } function getHour(timestamp) { return parseInt(timestamp.split(' ')[1].split(':')[0]) } function isDay(hour) { return hour >= 6 && hour < 20 } function analyzeData(csvData) { const dailyStats = {}; let latestWeight = null; let todayStats = null; const today = new Date().toISOString().split('T')[0]; csvData.forEach(row => { const timestamp = (row.timestamp || '').trim().replace(/\s+/g, ' '); if (!timestamp || !/\d{4}-\d{2}-\d{2}/.test(timestamp)) return; const date = timestamp.split(' ')[0]; const shortDate = date.substring(5); const hour = getHour(timestamp); const isDayTime = isDay(hour); if (!dailyStats[shortDate]) { dailyStats[shortDate] = { æ¯ä¹³: 0, æ¯ä¹³æ—¶é•¿: 0, å¥¶ç²‰: 0, å¥¶ç²‰é‡: 0, ç¡çœ : [], è¾…é£Ÿ: 0, å¤§ä¾¿: 0, ç™½å¤©å–‚å¥¶: 0, å¤œé—´å–‚å¥¶: 0, ç™½å¤©ç¡çœ : 0, å¤œé—´ç¡çœ : 0, ä½“é‡: null } } const s = dailyStats[shortDate]; const type = (row.event_type || '').trim(); const sub = (row.subtype || '').trim(); const val = parseFloat(row.value || '0') || 0; const pair = (row.pair_key || '').trim(); if (type === 'å–‚å¥¶') { if (sub === 'æ¯ä¹³') { s.æ¯ä¹³++; if (val > 0) s.æ¯ä¹³æ—¶é•¿ += val; if (isDayTime) s.ç™½å¤©å–‚å¥¶++; else s.å¤œé—´å–‚å¥¶++ } else if (sub === 'å¥¶ç²‰') { s.å¥¶ç²‰++; if (val > 0) s.å¥¶ç²‰é‡ += val; if (isDayTime) s.ç™½å¤©å–‚å¥¶++; else s.å¤œé—´å–‚å¥¶++ } } else if (type === 'ç¡è§‰' && sub === 'ç»“æŸ' && pair) { try { const start = new Date(pair.replace(' ', 'T')); const end = new Date(timestamp.replace(' ', 'T')); if (!isNaN(start.getTime()) && !isNaN(end.getTime())) { const h = (end - start) / 3600000; if (h > 0 && h < 24) { s.ç¡çœ .push(h); const sh = getHour(pair); if (isDay(sh)) s.ç™½å¤©ç¡çœ  += h; else s.å¤œé—´ç¡çœ  += h } } } catch (e) { } } else if (type === 'ä½“é‡' && val > 0) { s.ä½“é‡ = val; latestWeight = val } else if (type === 'è¾…é£Ÿ') s.è¾…é£Ÿ++; else if (type === 'æ¢å°¿å¸ƒ' && sub === 'å¤§ä¾¿') s.å¤§ä¾¿++; if (date === today) todayStats = s }); const dates = Object.keys(dailyStats).sort(); const result = {}; dates.forEach(d => { const s = dailyStats[d]; const total = s.ç¡çœ .reduce((a, b) => a + b, 0); result[d] = { æ¯ä¹³: s.æ¯ä¹³, æ¯ä¹³æ—¶é•¿: s.æ¯ä¹³æ—¶é•¿, å¥¶ç²‰: s.å¥¶ç²‰, å¥¶ç²‰é‡: Math.round(s.å¥¶ç²‰é‡), ç¡çœ : Math.round(total * 10) / 10, ç¡çœ æ¬¡æ•°: s.ç¡çœ .length, æœ€é•¿ç¡çœ : s.ç¡çœ .length > 0 ? Math.max(...s.ç¡çœ ).toFixed(1) : 0, è¾…é£Ÿ: s.è¾…é£Ÿ, å¤§ä¾¿: s.å¤§ä¾¿, ç™½å¤©å–‚å¥¶: s.ç™½å¤©å–‚å¥¶, å¤œé—´å–‚å¥¶: s.å¤œé—´å–‚å¥¶, ç™½å¤©ç¡çœ : Math.round(s.ç™½å¤©ç¡çœ  * 10) / 10, å¤œé—´ç¡çœ : Math.round(s.å¤œé—´ç¡çœ  * 10) / 10, ä½“é‡: s.ä½“é‡ } }); return { data: result, dates: dates, weight: latestWeight, todayData: todayStats ? { ...todayStats, ç¡çœ æ€»: todayStats.ç¡çœ .reduce((a, b) => a + b, 0), æœ€é•¿: todayStats.ç¡çœ .length > 0 ? Math.max(...todayStats.ç¡çœ ) : 0 } : null } } function renderToday(td) { if (!td) { document.querySelector('.today-summary').style.display = 'none'; return } const now = new Date(); document.getElementById('todayDate').textContent = `(${now.getMonth() + 1}/${now.getDate()})`; document.getElementById('todayFeedingCount').textContent = td.æ¯ä¹³ + td.å¥¶ç²‰; document.getElementById('todayFormula').textContent = Math.round(td.å¥¶ç²‰é‡); document.getElementById('todayBreast').textContent = Math.round(td.æ¯ä¹³æ—¶é•¿); document.getElementById('todaySleepCount').textContent = td.ç¡çœ .length; document.getElementById('todaySleepTotal').textContent = td.ç¡çœ æ€».toFixed(1); document.getElementById('todaySleepMax').textContent = td.æœ€é•¿.toFixed(1); document.getElementById('todayDayFeeding').textContent = td.ç™½å¤©å–‚å¥¶; document.getElementById('todayDaySleep').textContent = td.ç™½å¤©ç¡çœ .toFixed(1); document.getElementById('todayNightFeeding').textContent = td.å¤œé—´å–‚å¥¶; document.getElementById('todayNightSleep').textContent = td.å¤œé—´ç¡çœ .toFixed(1); let hasOther = false; if (td.ä½“é‡) { document.getElementById('todayWeightCard').style.display = 'block'; document.getElementById('todayWeight').textContent = td.ä½“é‡; hasOther = true } if (td.è¾…é£Ÿ > 0) { document.getElementById('todayFoodCard').style.display = 'block'; document.getElementById('todayFood').textContent = td.è¾…é£Ÿ; hasOther = true } if (td.å¤§ä¾¿ > 0) { document.getElementById('todayPoopCard').style.display = 'block'; document.getElementById('todayPoop').textContent = td.å¤§ä¾¿; hasOther = true } if (hasOther) document.getElementById('todayOther').style.display = 'grid' } function renderCharts(analyzed) { if (!hasChartJS) { document.getElementById('status').textContent = 'âš ï¸ è¯·å…ˆåŠ è½½Chart.jså›¾è¡¨åº“'; document.getElementById('chartLibNotice').style.display = 'block'; chartData = analyzed; return } const { data, dates, weight, todayData } = analyzed; if (dates.length === 0) { document.getElementById('status').textContent = 'âŒ æ²¡æœ‰æ•°æ®'; return } document.getElementById('dataContainer').style.display = 'block'; renderToday(todayData); const totalS = dates.reduce((s, d) => s + data[d].ç¡çœ , 0); const totalFA = dates.reduce((s, d) => s + data[d].å¥¶ç²‰é‡, 0); const totalBT = dates.reduce((s, d) => s + data[d].æ¯ä¹³æ—¶é•¿, 0); document.getElementById('avgDailySleep').textContent = (totalS / dates.length).toFixed(1); document.getElementById('avgFormula').textContent = Math.round(totalFA / dates.length); document.getElementById('avgBreast').textContent = Math.round(totalBT / dates.length); document.getElementById('currentWeight').textContent = weight || '-'; Chart.defaults.font.size = 12; const calcFeeding = (d, type) => { const total = data[d].æ¯ä¹³ + data[d].å¥¶ç²‰ || 1; if (type === 'dayMilk') return (data[d].æ¯ä¹³ / total) * data[d].ç™½å¤©å–‚å¥¶; if (type === 'dayFormula') return (data[d].å¥¶ç²‰ / total) * data[d].ç™½å¤©å–‚å¥¶; if (type === 'nightMilk') return (data[d].æ¯ä¹³ / total) * data[d].å¤œé—´å–‚å¥¶; if (type === 'nightFormula') return (data[d].å¥¶ç²‰ / total) * data[d].å¤œé—´å–‚å¥¶ }; if (charts.f) charts.f.destroy(); charts.f = new Chart(document.getElementById('feedingChart'), { type: 'bar', data: { labels: dates, datasets: [{ label: 'æ¯ä¹³-ç™½å¤©', data: dates.map(d => calcFeeding(d, 'dayMilk')), backgroundColor: 'rgba(255,200,100,0.8)', stack: 'day' }, { label: 'å¥¶ç²‰-ç™½å¤©', data: dates.map(d => calcFeeding(d, 'dayFormula')), backgroundColor: 'rgba(100,180,255,0.8)', stack: 'day' }, { label: 'æ¯ä¹³-å¤œé—´', data: dates.map(d => calcFeeding(d, 'nightMilk')), backgroundColor: 'rgba(255,159,64,0.6)', stack: 'night' }, { label: 'å¥¶ç²‰-å¤œé—´', data: dates.map(d => calcFeeding(d, 'nightFormula')), backgroundColor: 'rgba(54,162,235,0.6)', stack: 'night' }] }, options: { responsive: !0, maintainAspectRatio: !0, scales: { y: { beginAtZero: !0 }, x: { stacked: !0 } } } }); if (charts.fm) charts.fm.destroy(); charts.fm = new Chart(document.getElementById('formulaChart'), { type: 'line', data: { labels: dates, datasets: [{ label: 'å¥¶ç²‰(ml)', data: dates.map(d => data[d].å¥¶ç²‰é‡), borderColor: 'rgba(54,162,235,1)', backgroundColor: 'rgba(54,162,235,0.2)', fill: !0, tension: .4 }] }, options: { responsive: !0, scales: { y: { beginAtZero: !0 } } } }); if (charts.b) charts.b.destroy(); charts.b = new Chart(document.getElementById('breastChart'), { type: 'line', data: { labels: dates, datasets: [{ label: 'æ¯ä¹³(åˆ†é’Ÿ)', data: dates.map(d => data[d].æ¯ä¹³æ—¶é•¿), borderColor: 'rgba(255,159,64,1)', backgroundColor: 'rgba(255,159,64,0.2)', fill: !0, tension: .4 }] }, options: { responsive: !0, scales: { y: { beginAtZero: !0 } } } }); if (charts.w) charts.w.destroy(); charts.w = new Chart(document.getElementById('weightChart'), { type: 'line', data: { labels: dates, datasets: [{ label: 'ä½“é‡(kg)', data: dates.map(d => data[d].ä½“é‡), borderColor: 'rgba(75,192,192,1)', backgroundColor: 'rgba(75,192,192,0.2)', fill: !0, tension: .4, spanGaps: !0 }] }, options: { responsive: !0, scales: { y: { beginAtZero: !1 } } } }); if (charts.p) charts.p.destroy(); charts.p = new Chart(document.getElementById('poopChart'), { type: 'bar', data: { labels: dates, datasets: [{ label: 'å¤§ä¾¿(æ¬¡)', data: dates.map(d => data[d].å¤§ä¾¿), backgroundColor: 'rgba(139,69,19,0.6)', borderColor: 'rgba(139,69,19,1)', borderWidth: 1 }] }, options: { responsive: !0, scales: { y: { beginAtZero: !0, ticks: { stepSize: 1 } } } } }); if (charts.s) charts.s.destroy(); charts.s = new Chart(document.getElementById('sleepChart'), { type: 'bar', data: { labels: dates, datasets: [{ label: 'ç™½å¤©(h)', data: dates.map(d => data[d].ç™½å¤©ç¡çœ ), backgroundColor: 'rgba(255,206,86,0.8)' }, { label: 'å¤œé—´(h)', data: dates.map(d => data[d].å¤œé—´ç¡çœ ), backgroundColor: 'rgba(153,102,255,0.8)' }] }, options: { responsive: !0, scales: { y: { beginAtZero: !0, stacked: !0 }, x: { stacked: !0 } } } }); document.getElementById('status').textContent = 'âœ… åŠ è½½æˆåŠŸ' } document.getElementById('csvFile').addEventListener('change', function (e) { const file = e.target.files[0]; if (!file) return; document.getElementById('status').textContent = 'è¯»å–ä¸­...'; const reader = new FileReader(); reader.onload = function (ev) { try { const csv = parseCSV(ev.target.result); if (csv.length === 0) { document.getElementById('status').textContent = 'âŒ æ— æ•°æ®'; return } const analyzed = analyzeData(csv); renderCharts(analyzed) } catch (err) { document.getElementById('status').textContent = 'âŒ é”™è¯¯:' + err.message; console.error(err) } }; reader.onerror = function () { document.getElementById('status').textContent = 'âŒ è¯»å–å¤±è´¥' }; reader.readAsText(file, 'UTF-8') })</script>
</body>

</html>